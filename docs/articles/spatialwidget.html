<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>spatialwidget • spatialwidget</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="spatialwidget">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spatialwidget</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/spatialwidget.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>spatialwidget</h1>
                        <h4 class="author">David Cooley</h4>
            
            <h4 class="date">2018-12-14</h4>
      
      
      <div class="hidden name"><code>spatialwidget.Rmd</code></div>

    </div>

    
    
<div id="spatialwidget" class="section level1">
<h1 class="hasAnchor">
<a href="#spatialwidget" class="anchor"></a>Spatialwidget</h1>
<p>This package is designed to convert R data to JSON, ready for plotting on a map in an <code>htmlwidget</code>.</p>
</div>
<div id="design" class="section level1">
<h1 class="hasAnchor">
<a href="#design" class="anchor"></a>Design</h1>
<p>The basic idea of this package is to take an <code>sf</code> object or data.frame</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>( widget_capitals )</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#  Simple feature collection with 6 features and 2 fields</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#  geometry type:  POINT</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#  dimension:      XY</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#  bbox:           xmin: -170.43 ymin: -14.16 xmax: 69.11 ymax: 42.31</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#  epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#  proj4string:    NA</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#           country          capital               geometry</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#  1    Afghanistan            Kabul    POINT (69.11 34.28)</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#  2        Albania           Tirane    POINT (19.49 41.18)</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#  3        Algeria          Algiers     POINT (3.08 36.42)</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#  4 American Samoa        Pago Pago POINT (-170.43 -14.16)</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#  5        Andorra Andorra la Vella     POINT (1.32 42.31)</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#  6         Angola           Luanda     POINT (13.15 -8.5)</span></a></code></pre></div>
<p>And convert it into pseudo-geojson ready to be parsed by javascript inside an htmlwidget</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">js &lt;-<span class="st"> </span>spatialwidget<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/spatialwidget/topics/widget_point">widget_point</a></span>( <span class="dt">data =</span> widget_capitals, <span class="dt">fill_colour =</span> <span class="st">"country"</span>, <span class="dt">legend =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( js<span class="op">$</span>data, <span class="dv">1</span>, <span class="dv">200</span> )</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#  [{"type":"Feature","properties":{"fill_colour":"#440154FF"},"geometry":{"geometry":{"type":"Point","coordinates":[69.11,34.28]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"fill_colour":"#450356FF"},"geometry":</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( js<span class="op">$</span>legend, <span class="dv">1</span>, <span class="dv">100</span> )</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#  {"fill_colour":{"colour":["#440154FF","#450356FF","#450458FF","#45065AFF","#46085CFF","#460A5EFF","#</span></a></code></pre></div>
<p>Notice the <code>fill_colour</code> column is now a hex colour, and the <code>geometry</code> column has been converted into <code>Point</code> coordinates.</p>
<p>This is basically it. The R object is now represented as JSON, having had a column of data changed into hex colours.</p>
<hr>
</div>
<div id="r-interface" class="section level1">
<h1 class="hasAnchor">
<a href="#r-interface" class="anchor"></a>R Interface</h1>
<p>Here I describe the R functions available to you. However, these are deliberately limited in their capability, as this library is not intended to be used directly at the R-level. Instead, it’s designed to be integrated into packages at the C++ level, where you will call the C++ functions directly.</p>
<hr>
<p>There are 4 R functions you can call for creating POINTs, LINEs, POLYGONs or origin-destination shapes. Each of these functions returns a list with two elements, <code>data</code> and <code>legend</code>.</p>
<ul>
<li>data : the R <code>data.frame</code> or <code>sf</code> object converted to pseudo-GeoJSON</li>
<li>legend : a summary of the values and colours suitable for a legend on the map</li>
</ul>
<div id="pseudo-geojson" class="section level2">
<h2 class="hasAnchor">
<a href="#pseudo-geojson" class="anchor"></a>Pseudo-GeoJSON</h2>
<p>The <code>data</code> is returned as <strong>pseudo-GeoJSON</strong>. Some plotting libraries can use more than one geometry, such as <a href="https://github.com/SymbolixAU/mapdeck/blob/master/R/map_layer_arc.R"><code><a href="https://www.rdocumentation.org/packages/mapdeck/topics/add_arc">mapdeck::add_arc()</a></code></a>, which uses an origin and destination. So spatialwidget needs to handle multiple geometries.</p>
<p>Typical GeoJSON will take the form</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1">[<span class="op">{</span><span class="st">"type"</span><span class="op">:</span><span class="st">"Feature"</span><span class="op">,</span> <span class="st">"properties"</span><span class="op">:{},</span><span class="st">"geometry"</span><span class="op">:{</span><span class="st">"type"</span><span class="op">:</span><span class="st">"Point"</span><span class="op">,</span><span class="st">"coordinates"</span><span class="op">:</span>[<span class="dv">0</span><span class="op">,</span><span class="dv">0</span>]<span class="op">}}</span>]</a></code></pre></div>
<p>Whereas I’ve nested the geometries one-level deeper, so the pseudo-GeoJSON i’m using takes the form</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" data-line-number="1">[<span class="op">{</span><span class="st">"type"</span><span class="op">:</span><span class="st">"Feature"</span><span class="op">,</span> <span class="st">"properties"</span><span class="op">:{},</span><span class="st">"geometry"</span><span class="op">:{</span><span class="st">"myGeometry"</span><span class="op">:{</span><span class="st">"type"</span><span class="op">:</span><span class="st">"Point"</span><span class="op">,</span><span class="st">"coordinates"</span><span class="op">:</span>[<span class="dv">0</span><span class="op">,</span><span class="dv">0</span>]<span class="op">}}}</span>]</a></code></pre></div>
<p>Where the <code>myGeometry</code> object is defined on a per-application bases. You are free to call this whatever you want inside your library, and have as many as you want.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="points" class="section level3">
<h3 class="hasAnchor">
<a href="#points" class="anchor"></a>Points</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw"><a href="../reference/widget_point.html">widget_point</a></span>( widget_capitals[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ], <span class="dt">fill_colour =</span> <span class="st">"country"</span>, <span class="dt">legend =</span> T )</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( l<span class="op">$</span>data, <span class="dv">1</span>, <span class="dv">200</span> )</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#  [{"type":"Feature","properties":{"fill_colour":"#440154FF"},"geometry":{"geometry":{"type":"Point","coordinates":[69.11,34.28]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"fill_colour":"#FDE725FF"},"geometry":</span></a></code></pre></div>
</div>
<div id="lines" class="section level3">
<h3 class="hasAnchor">
<a href="#lines" class="anchor"></a>Lines</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw"><a href="../reference/widget_line.html">widget_line</a></span>( widget_roads[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ], <span class="dt">stroke_colour =</span> <span class="st">"ROAD_NAME"</span>, <span class="dt">legend =</span> T )</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( l<span class="op">$</span>data, <span class="dv">1</span>, <span class="dv">200</span> )</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#  [{"type":"Feature","properties":{"stroke_colour":"#440154FF","stroke_width":1.0},"geometry":{"geometry":{"type":"LineString","coordinates":[[145.014291,-37.830458],[145.014345,-37.830574],[145.01449,-</span></a></code></pre></div>
</div>
<div id="polygon" class="section level3">
<h3 class="hasAnchor">
<a href="#polygon" class="anchor"></a>Polygon</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw"><a href="../reference/widget_polygon.html">widget_polygon</a></span>( widget_melbourne[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ], <span class="dt">fill_colour =</span> <span class="st">"AREASQKM16"</span>, <span class="dt">legend =</span> F)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( l<span class="op">$</span>data, <span class="dv">1</span>, <span class="dv">200</span> )</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#  [{"type":"Feature","properties":{"stroke_colour":"#440154FF","stroke_width":1.0,"fill_colour":"#440154FF"},"geometry":{"geometry":{"type":"Polygon","coordinates":[[[144.9925232,-37.8024902],[144.99264</span></a></code></pre></div>
<hr>
</div>
</div>
</div>
<div id="c-api" class="section level1">
<h1 class="hasAnchor">
<a href="#c-api" class="anchor"></a>C++ API</h1>
<p>The <code>spatialwidget::api::</code> namespace has 5 functions for converting your data into pseudo-geojson. Here are their definitions, the input data they expect and the type of output they produce.</p>
<div id="many-sfc-column-sf-to-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#many-sfc-column-sf-to-pseudo-geojson" class="anchor"></a>many-<code>sfc</code>-column <code>sf</code> to pseudo-geojson</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"> * sf object with one or many sfc columns</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"> *</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"> * expects `data` to be an sf object, where the geometry_columns is a string vector</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"> * containing the sfc colunm names (of sf) you want to use as the geometry objects</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"> * inside the GeoJSON</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"> */</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">inline</span> Rcpp::List create_geojson(</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    Rcpp::List&amp; data_types,</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">    <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    Rcpp::StringVector&amp; geometry_columns,</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    <span class="dt">bool</span> jsonify_legend</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">  )</a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one or many <code>sfc</code> columns</p>
<p><strong>out</strong> - geometries left as-is, returned in pseudo-geojson</p>
<hr>
</div>
<div id="single-sfc-column-sf-to-standard-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#single-sfc-column-sf-to-standard-geojson" class="anchor"></a>single-<code>sfc</code>-column <code>sf</code> to standard geojson</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co"> * expects `data` to be an sf object, where the geometry_column is a string vector</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co"> * of the sfc column names (of sf) you want to use as the geometry object inside the GeoJSON.</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"> *</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"> */</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw">inline</span> Rcpp::List create_geojson(</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    Rcpp::List&amp; data_types,</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">    Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">    <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">    Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">    <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    <span class="bu">std::</span>string&amp; geometry_column,              <span class="co">// single geometry column from sf object</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">    <span class="dt">bool</span> jsonify_legend</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">)</a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one <code>sfc</code> column</p>
<p><strong>out</strong> - returns standard geojson</p>
<hr>
</div>
<div id="single-sfc-column-sf-to-down-casted-geometries-in-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#single-sfc-column-sf-to-down-casted-geometries-in-pseudo-geojson" class="anchor"></a>single-<code>sfc</code>-column <code>sf</code> to down-casted geometries in pseudo-geojson</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"> * expects `data` to be an sf object, where the geometry_column is a string</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"> * of the sfc column names (of sf) you want to use as the geometry object inside the GeoJSON.</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"> * This function will down-cast MULTI* objects to their single form</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"> *</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co"> */</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="kw">inline</span> Rcpp::List create_geojson_downcast(</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    Rcpp::List&amp; data_types,</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">    Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">    <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">    Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    <span class="bu">std::</span>string&amp; geometry_column,</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    <span class="dt">bool</span> jsonify_legend</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">)</a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one <code>sfc</code> column</p>
<p><strong>out</strong> - MULTI* geometries down-cast to simpler form, in pseudo-geojson</p>
<hr>
</div>
<div id="two-sfc-column-sf-to-down-casted-psuedo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#two-sfc-column-sf-to-down-casted-psuedo-geojson" class="anchor"></a>two-<code>sfc</code>-column <code>sf</code> to down-casted psuedo-geojson</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb12-1" data-line-number="1">  <span class="co">/*</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">   * expects `data` to be an sf object, where the geometry_column is a string vector</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">   * of the sfc column name (of sf) you want to use as the geometry object inside the GeoJSON.</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">   * This function will down-cast MULTI* objects to their single form</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">   *</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">   */</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="kw">inline</span> Rcpp::List create_geojson_downcast(</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">      Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">      Rcpp::List&amp; data_types, <span class="co">// named list, names == data.names(), values == data.class[[1]] ?</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">      Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">      Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">      <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">      Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">      <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">      Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">      Rcpp::StringVector&amp; geometry_column,</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">      <span class="dt">bool</span> jsonify_legend</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">  )</a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with two <code>sfc</code> columns</p>
<p><strong>out</strong> - MULTI* geometries down-cast to simpler form, in pseudo-geojson</p>
<hr>
</div>
<div id="data-frame-with-lon-lat-columns-to-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frame-with-lon-lat-columns-to-pseudo-geojson" class="anchor"></a><code>data.frame</code> with lon &amp; lat columns to pseudo-geojson</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co"> * expects `data` to be data.frame withn lon &amp; lat columns. The geometry_columns</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co"> * argument is a named list, list(myGeometry = c("lon","lat")), where 'myGeometry'</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"> * will be returned inside the 'geometry' object of the GeoJSON</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"> */</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">inline</span> Rcpp::List create_geojson(</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    Rcpp::List&amp; data_types,</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">    Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">    <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">    Rcpp::List&amp; geometry_columns,</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    <span class="dt">bool</span> jsonify_legend</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">)</a></code></pre></div>
<p><strong>in</strong> - <code>data.frame</code> with lon &amp; lat columns (each row is a POINT)</p>
<p><strong>out</strong> - pseudo-geojson</p>
<hr>
</div>
<div id="data-frame-with-lon-lat-elevation-columns-to-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frame-with-lon-lat-elevation-columns-to-pseudo-geojson" class="anchor"></a><code>data.frame</code> with lon, lat &amp; elevation columns to pseudo-geojson</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co"> * expects `data` to be data.frame withn lon &amp; lat &amp; elev columns. The 'bool elevation'</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co"> * argument must be set to 'true', and the 'geometry_columns' should contain an 'elevation'</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"> * value - 'geometry_column &lt;- list( geometry = c("lon","lat","elevation") )'</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co"> */</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">inline</span> Rcpp::List create_geojson(</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    Rcpp::DataFrame&amp; data,</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    Rcpp::List&amp; data_types,</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    Rcpp::List&amp; params,</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">    Rcpp::List&amp; lst_defaults,</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">    <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt;&amp; layer_colours,</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">    Rcpp::StringVector&amp; layer_legend,</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    <span class="dt">int</span>&amp; data_rows,</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">    Rcpp::StringVector&amp; parameter_exclusions,</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">    Rcpp::List&amp; geometry_columns,</a>
<a class="sourceLine" id="cb14-16" data-line-number="16">    <span class="dt">bool</span> jsonify_legend,</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">    <span class="dt">bool</span> elevation</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">)</a></code></pre></div>
<p><strong>in</strong> - <code>data.frame</code> with lon, lat and elevation columns (each row is a POINT)</p>
<p><strong>out</strong> - pseudo-gejson</p>
<hr>
</div>
<div id="c-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#c-arguments" class="anchor"></a>C++ arguments</h2>
<p>This set of arguments are commong to all the C++ functions</p>
<div id="rcppdataframe-data" class="section level3">
<h3 class="hasAnchor">
<a href="#rcppdataframe-data" class="anchor"></a>Rcpp::DataFrame data</h3>
<p>This will either be a data.frame with lon &amp; lat columns, or an <code>sf</code> object.</p>
</div>
<div id="rcpplist-data_types" class="section level3">
<h3 class="hasAnchor">
<a href="#rcpplist-data_types" class="anchor"></a>Rcpp::List data_types</h3>
<p>A named vector. Each name is the columns of <code>data</code>, and the values are the <code>r</code> data types of the column. Only one value per name is accepted. This is used to help determine how the legend values should be formatted.</p>
<p>An example is</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">val =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">data_types &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">vapply</a></span>( df, <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(x)[[<span class="dv">1</span>]], <span class="st">""</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">data_types</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#         id       val </span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#  "integer"  "factor"</span></a></code></pre></div>
</div>
<div id="rcpplist-params" class="section level3">
<h3 class="hasAnchor">
<a href="#rcpplist-params" class="anchor"></a>Rcpp::List params</h3>
<p>A named list. The names are the arguments of the calling R function which will be supplied to the javascript widget. These are typically columns of <code>data</code>, or a single value that will be applied to all rows of <code>data</code>.</p>
<p>For example, an R function will look like</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">add_layer &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  data, </a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">fill_colour =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="dt">stroke_colour =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  <span class="dt">another_argument =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">)</a></code></pre></div>
<p>And the list passed to c++ will be</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">l[[<span class="st">"fill_colour"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/force">force</a></span>( fill_colour )</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">l[[<span class="st">"stroke_colour"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/force">force</a></span>( stroke_colour ) </a></code></pre></div>
<p>In this case, the <code>another_argument</code> is not passed to the javascript widget as part of the data, so we don’t include it in our list.</p>
<p>The javascript function inside a <code>htmlwidget</code> will then access the <code>stroke_colour</code> and <code>fill_colour</code> properties from the data.</p>
<p>This example code is taken from the javascript binding of <code><a href="https://www.rdocumentation.org/packages/mapdeck/topics/add_polygon">mapdeck::add_polygon()</a></code> to show you how I use it.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">const</span> polygonLayer <span class="op">=</span> <span class="kw">new</span> <span class="at">PolygonLayer</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">    <span class="dt">getLineColor</span><span class="op">:</span> d <span class="op">=&gt;</span> <span class="at">hexToRGBA2</span>( <span class="va">d</span>.<span class="va">properties</span>.<span class="at">stroke_colour</span> )<span class="op">,</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">    <span class="dt">getFillColor</span><span class="op">:</span> d <span class="op">=&gt;</span> <span class="at">hexToRGBA2</span>( <span class="va">d</span>.<span class="va">properties</span>.<span class="at">fill_colour</span> )<span class="op">,</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</div>
<div id="rcpplist-lst_defaults" class="section level3">
<h3 class="hasAnchor">
<a href="#rcpplist-lst_defaults" class="anchor"></a>Rcpp::List lst_defaults</h3>
<p>Either a named list, or an empty list.</p>
<p>You can use this list to supply default values to the widget.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb19-1" data-line-number="1"></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">Rcpp::List scatterplot_defaults(<span class="dt">int</span> n) {</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="cf">return</span> Rcpp::List::create(</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">        _[<span class="st">"fill_colour"</span>] = mapdeck::defaults::default_fill_colour(n)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    );</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">// use Either a named list, </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">Rcpp::List lst_defaults = scatterplot_defaults( data_rows );  <span class="co">// initialise with defaults</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">// or an empty object</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">Rcpp::List lst_defaults;</a></code></pre></div>
</div>
<div id="stdunordered_map-stdstring-stdstring-layer_colours" class="section level3">
<h3 class="hasAnchor">
<a href="#stdunordered_map-stdstring-stdstring-layer_colours" class="anchor"></a>std::unordered_map&lt; std::string, std::string &gt; layer_colours</h3>
<p>A c++ <code>unorderd_map</code> specifying colours and their associated opacity.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt; polygon_colours = {</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">    { <span class="st">"fill_colour"</span>, <span class="st">"fill_opacity"</span> },</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">    { <span class="st">"stroke_colour"</span>, <span class="st">"stroke_opacity"</span>}</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  };</a></code></pre></div>
<p>These values will match the colour parameters used in the <code>params</code> list</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">l[[<span class="st">"fill_colour"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/force">force</a></span>( fill_colour )</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">l[[<span class="st">"stroke_colour"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/force">force</a></span>( stroke_colour ) </a></code></pre></div>
<p>But you don’t have to supply the opacity, it will be set to ‘opaque’ by default.</p>
</div>
<div id="rcppstringvector-layer_legend" class="section level3">
<h3 class="hasAnchor">
<a href="#rcppstringvector-layer_legend" class="anchor"></a>Rcpp::StringVector layer_legend</h3>
<p>A vector of the colour values you want to use in a lenged.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="at">const</span> Rcpp::StringVector polygon_legend = Rcpp::StringVector::create(</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">    <span class="st">"fill_colour"</span>, <span class="st">"stroke_colour"</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  );</a></code></pre></div>
<p>In this example, both <code>fill_colour</code> and <code>stroke_colour</code> will be returned in the legend data.</p>
</div>
<div id="int-data_rows" class="section level3">
<h3 class="hasAnchor">
<a href="#int-data_rows" class="anchor"></a>int data_rows</h3>
<p>The number of rows of <code>data</code>.</p>
</div>
<div id="rcppstringvector-parameter_exclusions" class="section level3">
<h3 class="hasAnchor">
<a href="#rcppstringvector-parameter_exclusions" class="anchor"></a>Rcpp::StringVector parameter_exclusions</h3>
<p>A vector describing the elements of <code>params</code> which will be excluded from the final JSON data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb23-1" data-line-number="1">Rcpp::StringVector parameter_exclusions = Rcpp::StringVector::create(<span class="st">"palette"</span>,<span class="st">"legend"</span>,<span class="st">"na_colour"</span>);</a></code></pre></div>
</div>
<div id="bool-jsonify_legend" class="section level3">
<h3 class="hasAnchor">
<a href="#bool-jsonify_legend" class="anchor"></a>bool jsonify_legend</h3>
<p>A logical value indicating if you want the legend data returned as JSON (TRUE) or a a list (FALSE)</p>
</div>
</div>
<div id="function-dependent-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#function-dependent-arguments" class="anchor"></a>Function-dependent arguments</h2>
<hr>
<div id="geometry_columns" class="section level3">
<h3 class="hasAnchor">
<a href="#geometry_columns" class="anchor"></a>geometry_columns</h3>
<p>Either an <code>Rcpp::List</code> or <code>Rcpp::StringVector</code>.</p>
<p>The <code>List</code> is used for <code>data.frame</code>s with lon &amp; lat columns.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">lon =</span> <span class="dv">0</span>, <span class="dt">lat =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">geometry_column &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>( <span class="dt">geometry =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>) )</a></code></pre></div>
<p>The <code>StringVector</code> is used for <code>sf</code> objects to specify the geometry columns.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">sf &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>( <span class="dt">origin =</span> sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>( sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_point</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span> ) ) ) )</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">geometry_column &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>( <span class="st">"origin"</span> )</a></code></pre></div>
</div>
<div id="bool-elevation" class="section level3">
<h3 class="hasAnchor">
<a href="#bool-elevation" class="anchor"></a>bool elevation</h3>
<p>The <code>elevation</code> argument is used when the <code>data.frame</code> has a column of elevation data. When using the elevation you also need to supply this column in the <code>geometry_column</code> list.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">geometry_column &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>( <span class="dt">geometry =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>,<span class="st">"elevation"</span>) )</a></code></pre></div>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Here’s an example implementation of the R, cpp and hpp files required to convert R data to pseudo-GeoJSON</p>
<p><strong>widgetpoint.R</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co">#' Widget Point</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#' Converts an `sf` object with POINT geometriers into JSON for plotting in an htmlwidget</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#' @param data `sf` object with POINT geometries</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#' @param fill_colour string specifying column of `sf` to use for the fill colour</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#' @param legend logical indicating if legend data will be returned</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#' @param json_legend logical indicating if the lgend will be returned as JSON or a list</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#' @examples</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#' l &lt;- widget_point( data = capitals, fill_colour = "country", legend = FALSE )</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#' @export</span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15">widget_point &lt;-<span class="st"> </span><span class="cf">function</span>( data,</a>
<a class="sourceLine" id="cb27-16" data-line-number="16">                          fill_colour,</a>
<a class="sourceLine" id="cb27-17" data-line-number="17">                          <span class="dt">legend =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb27-18" data-line-number="18">                          <span class="dt">json_legend =</span> <span class="ot">TRUE</span> ) {</a>
<a class="sourceLine" id="cb27-19" data-line-number="19"></a>
<a class="sourceLine" id="cb27-20" data-line-number="20">  l &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb27-21" data-line-number="21">  l[[<span class="st">"fill_colour"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/force">force</a></span>( fill_colour )</a>
<a class="sourceLine" id="cb27-22" data-line-number="22">  l[[<span class="st">"legend"</span>]] &lt;-<span class="st"> </span>legend</a>
<a class="sourceLine" id="cb27-23" data-line-number="23"></a>
<a class="sourceLine" id="cb27-24" data-line-number="24">  data_types &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">vapply</a></span>( data, <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(x)[[<span class="dv">1</span>]], <span class="st">""</span>)</a>
<a class="sourceLine" id="cb27-25" data-line-number="25"></a>
<a class="sourceLine" id="cb27-26" data-line-number="26">  js_data &lt;-<span class="st"> </span><span class="kw">rcpp_widget_point</span>( data, data_types, l, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"geometry"</span>), json_legend )</a>
<a class="sourceLine" id="cb27-27" data-line-number="27"></a>
<a class="sourceLine" id="cb27-28" data-line-number="28">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>( js_data )</a>
<a class="sourceLine" id="cb27-29" data-line-number="29">}</a></code></pre></div>
<p><strong>widgetpoint.cpp</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="pp">#include </span><span class="im">"spatialwidget/spatialwidget.hpp"</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="pp">#include </span><span class="im">"spatialwidget/spatialwidget_defaults.hpp"</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="pp">#include </span><span class="im">"spatialwidget/layers/widgetpoint.hpp"</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="co">// [[Rcpp::export]]</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">Rcpp::List rcpp_widget_point(</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">    Rcpp::DataFrame data,</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">    Rcpp::List data_types,</a>
<a class="sourceLine" id="cb28-10" data-line-number="10">    Rcpp::List params,</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">    Rcpp::StringVector geometry_columns,</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">    <span class="dt">bool</span> jsonify_legend ) {</a>
<a class="sourceLine" id="cb28-13" data-line-number="13"></a>
<a class="sourceLine" id="cb28-14" data-line-number="14">  <span class="dt">int</span> data_rows = data.nrows();</a>
<a class="sourceLine" id="cb28-15" data-line-number="15">  Rcpp::List defaults = point_defaults( data_rows );</a>
<a class="sourceLine" id="cb28-16" data-line-number="16"></a>
<a class="sourceLine" id="cb28-17" data-line-number="17">  <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt; point_colours = spatialwidget::widgetpoint::point_colours;</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">  Rcpp::StringVector point_legend = spatialwidget::widgetpoint::point_legend;</a>
<a class="sourceLine" id="cb28-19" data-line-number="19">  Rcpp::StringVector parameter_exclusions = Rcpp::StringVector::create(<span class="st">"legend"</span>,<span class="st">"legend_options"</span>,<span class="st">"palette"</span>,<span class="st">"na_colour"</span>);</a>
<a class="sourceLine" id="cb28-20" data-line-number="20"></a>
<a class="sourceLine" id="cb28-21" data-line-number="21">  <span class="cf">return</span> spatialwidget::api::create_geojson(</a>
<a class="sourceLine" id="cb28-22" data-line-number="22">    data,</a>
<a class="sourceLine" id="cb28-23" data-line-number="23">    data_types,</a>
<a class="sourceLine" id="cb28-24" data-line-number="24">    params,</a>
<a class="sourceLine" id="cb28-25" data-line-number="25">    defaults,</a>
<a class="sourceLine" id="cb28-26" data-line-number="26">    point_colours,</a>
<a class="sourceLine" id="cb28-27" data-line-number="27">    point_legend,</a>
<a class="sourceLine" id="cb28-28" data-line-number="28">    data_rows,</a>
<a class="sourceLine" id="cb28-29" data-line-number="29">    parameter_exclusions,</a>
<a class="sourceLine" id="cb28-30" data-line-number="30">    geometry_columns,</a>
<a class="sourceLine" id="cb28-31" data-line-number="31">    jsonify_legend</a>
<a class="sourceLine" id="cb28-32" data-line-number="32">  );</a>
<a class="sourceLine" id="cb28-33" data-line-number="33">}</a></code></pre></div>
<p><strong>/layers/widgetpoint.hpp</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="pp">#ifndef SPATIALWIDGET_WIDGETPOINT_H</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="pp">#define SPATIALWIDGET_WIDGETPOINT_H</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="kw">namespace</span> spatialwidget {</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="kw">namespace</span> widgetpoint {</a>
<a class="sourceLine" id="cb29-7" data-line-number="7"></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co">// map between colour and opacity values</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9">  <span class="bu">std::</span>unordered_map&lt; <span class="bu">std::</span>string, <span class="bu">std::</span>string &gt; point_colours = {</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">    { <span class="st">"fill_colour"</span>, <span class="st">"fill_opacity"</span> }</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">  };</a>
<a class="sourceLine" id="cb29-12" data-line-number="12"></a>
<a class="sourceLine" id="cb29-13" data-line-number="13">  <span class="co">// vector of possible legend components</span></a>
<a class="sourceLine" id="cb29-14" data-line-number="14">  Rcpp::StringVector point_legend = Rcpp::StringVector::create(</a>
<a class="sourceLine" id="cb29-15" data-line-number="15">    <span class="st">"fill_colour"</span></a>
<a class="sourceLine" id="cb29-16" data-line-number="16">  );</a>
<a class="sourceLine" id="cb29-17" data-line-number="17"></a>
<a class="sourceLine" id="cb29-18" data-line-number="18">} <span class="co">// namespace widgetpoint</span></a>
<a class="sourceLine" id="cb29-19" data-line-number="19">} <span class="co">// namespace spatialwidget</span></a>
<a class="sourceLine" id="cb29-20" data-line-number="20"></a>
<a class="sourceLine" id="cb29-21" data-line-number="21"><span class="pp">#endif</span></a></code></pre></div>
</div>
<div id="atomising-geojson" class="section level2">
<h2 class="hasAnchor">
<a href="#atomising-geojson" class="anchor"></a>Atomising geojson</h2>
<p>As well as creating pseudo-GeoJSON, most of the functions also <strong>atomise</strong> the data.</p>
<p>When converting an <code>sf</code> object to GeoJSON it will typically create a FeatureCollection. ‘Atomising’ means it treats each row of the <code>sf</code> as it’s own Feature, and stores each one in a separate JSON object inside a JSON array (i.e., without combining them into a Feature Collection).</p>
<p>For example, we can create a GeoJSON FeatureCollection, convert it to <code>sf</code> and back again</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">feat1 &lt;-<span class="st"> '{"type":"Feature","properties":{"id":1},"geometry":{"type":"Point","coordinates":[0,0]}}'</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">feat2 &lt;-<span class="st"> '{"type":"Feature","properties":{"id":2},"geometry":{"type":"Point","coordinates":[1,1]}}'</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3">geojson &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'[{"type":"FeatureCollection","features":['</span>,feat1,<span class="st">','</span>,feat2,<span class="st">']}]'</span>)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">sf &lt;-<span class="st"> </span>geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/geojson_sf">geojson_sf</a></span>( geojson )</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">sf</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#  Simple feature collection with 2 features and 1 field</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#  geometry type:  POINT</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co">#  dimension:      XY</span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#  bbox:           xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="co">#  epsg (SRID):    4326</span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co">#  proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co">#    id    geometry</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="co">#  1  1 POINT (0 0)</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#  2  2 POINT (1 1)</span></a></code></pre></div>
<p>and going back the other way completes the round-trip and creates a FeatureCollection.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">geo &lt;-<span class="st"> </span>geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/sf_geojson">sf_geojson</a></span>( sf )</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">geo</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co">#  {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":1.0},"geometry":{"type":"Point","coordinates":[0.0,0.0]}},{"type":"Feature","properties":{"id":2.0},"geometry":{"type":"Point","coordinates":[1.0,1.0]}}]}</span></a></code></pre></div>
<p>If we set it to ‘atomise’ when converting to geojson, an array of <code>Features</code> is returned</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/sf_geojson">sf_geojson</a></span>( sf, <span class="dt">atomise =</span> <span class="ot">TRUE</span> )</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="co">#  {"type":"Feature","properties":{"id":1.0},"geometry":{"type":"Point","coordinates":[0.0,0.0]}} </span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">#  {"type":"Feature","properties":{"id":2.0},"geometry":{"type":"Point","coordinates":[1.0,1.0]}}</span></a></code></pre></div>
<p>This structure is useful for sending to an htmlwidget because each object in the array can be parsed independently, without having to worry about iterating or parsing the entire Featurecollection.</p>
<p>Therefore, most of the GeoJSON functions inside spatialwidget will return the ‘atomised’ form.</p>
</div>
<div id="downcasting-geojson" class="section level2">
<h2 class="hasAnchor">
<a href="#downcasting-geojson" class="anchor"></a>Downcasting geojson</h2>
<p><strong>Downcasting</strong> is the process of converting MULTI objects to their simpler form. For example, a MULTIPOINT will be down-cast to POINTs (one row/value for each of the multipoints).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">js &lt;-<span class="st"> '{"type":"Feature","properties":{"id":1,"val":"a"},"geometry":{"type":"MultiPoint","coordinates":[[1,4],[2,5],[3,6]]}}'</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">sf &lt;-<span class="st"> </span>geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/geojson_sf">geojson_sf</a></span>( js )</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">geo_down &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_sf_to_geojson_downcast</span>( sf, <span class="st">"geometry"</span> )</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">jsonlite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/prettify">prettify</a></span>( geo_down )</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co">#  [</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">#      {</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="co">#          "type": "Feature",</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#          "properties": {</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">#              "id": 1.0,</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">#              "val": "a"</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">#          },</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">#          "geometry": {</span></a>
<a class="sourceLine" id="cb33-13" data-line-number="13"><span class="co">#              "geometry": {</span></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"><span class="co">#                  "type": "Point",</span></a>
<a class="sourceLine" id="cb33-15" data-line-number="15"><span class="co">#                  "coordinates": [</span></a>
<a class="sourceLine" id="cb33-16" data-line-number="16"><span class="co">#                      1.0,</span></a>
<a class="sourceLine" id="cb33-17" data-line-number="17"><span class="co">#                      4.0</span></a>
<a class="sourceLine" id="cb33-18" data-line-number="18"><span class="co">#                  ]</span></a>
<a class="sourceLine" id="cb33-19" data-line-number="19"><span class="co">#              }</span></a>
<a class="sourceLine" id="cb33-20" data-line-number="20"><span class="co">#          }</span></a>
<a class="sourceLine" id="cb33-21" data-line-number="21"><span class="co">#      },</span></a>
<a class="sourceLine" id="cb33-22" data-line-number="22"><span class="co">#      {</span></a>
<a class="sourceLine" id="cb33-23" data-line-number="23"><span class="co">#          "type": "Feature",</span></a>
<a class="sourceLine" id="cb33-24" data-line-number="24"><span class="co">#          "properties": {</span></a>
<a class="sourceLine" id="cb33-25" data-line-number="25"><span class="co">#              "id": 1.0,</span></a>
<a class="sourceLine" id="cb33-26" data-line-number="26"><span class="co">#              "val": "a"</span></a>
<a class="sourceLine" id="cb33-27" data-line-number="27"><span class="co">#          },</span></a>
<a class="sourceLine" id="cb33-28" data-line-number="28"><span class="co">#          "geometry": {</span></a>
<a class="sourceLine" id="cb33-29" data-line-number="29"><span class="co">#              "geometry": {</span></a>
<a class="sourceLine" id="cb33-30" data-line-number="30"><span class="co">#                  "type": "Point",</span></a>
<a class="sourceLine" id="cb33-31" data-line-number="31"><span class="co">#                  "coordinates": [</span></a>
<a class="sourceLine" id="cb33-32" data-line-number="32"><span class="co">#                      2.0,</span></a>
<a class="sourceLine" id="cb33-33" data-line-number="33"><span class="co">#                      5.0</span></a>
<a class="sourceLine" id="cb33-34" data-line-number="34"><span class="co">#                  ]</span></a>
<a class="sourceLine" id="cb33-35" data-line-number="35"><span class="co">#              }</span></a>
<a class="sourceLine" id="cb33-36" data-line-number="36"><span class="co">#          }</span></a>
<a class="sourceLine" id="cb33-37" data-line-number="37"><span class="co">#      },</span></a>
<a class="sourceLine" id="cb33-38" data-line-number="38"><span class="co">#      {</span></a>
<a class="sourceLine" id="cb33-39" data-line-number="39"><span class="co">#          "type": "Feature",</span></a>
<a class="sourceLine" id="cb33-40" data-line-number="40"><span class="co">#          "properties": {</span></a>
<a class="sourceLine" id="cb33-41" data-line-number="41"><span class="co">#              "id": 1.0,</span></a>
<a class="sourceLine" id="cb33-42" data-line-number="42"><span class="co">#              "val": "a"</span></a>
<a class="sourceLine" id="cb33-43" data-line-number="43"><span class="co">#          },</span></a>
<a class="sourceLine" id="cb33-44" data-line-number="44"><span class="co">#          "geometry": {</span></a>
<a class="sourceLine" id="cb33-45" data-line-number="45"><span class="co">#              "geometry": {</span></a>
<a class="sourceLine" id="cb33-46" data-line-number="46"><span class="co">#                  "type": "Point",</span></a>
<a class="sourceLine" id="cb33-47" data-line-number="47"><span class="co">#                  "coordinates": [</span></a>
<a class="sourceLine" id="cb33-48" data-line-number="48"><span class="co">#                      3.0,</span></a>
<a class="sourceLine" id="cb33-49" data-line-number="49"><span class="co">#                      6.0</span></a>
<a class="sourceLine" id="cb33-50" data-line-number="50"><span class="co">#                  ]</span></a>
<a class="sourceLine" id="cb33-51" data-line-number="51"><span class="co">#              }</span></a>
<a class="sourceLine" id="cb33-52" data-line-number="52"><span class="co">#          }</span></a>
<a class="sourceLine" id="cb33-53" data-line-number="53"><span class="co">#      }</span></a>
<a class="sourceLine" id="cb33-54" data-line-number="54"><span class="co">#  ]</span></a>
<a class="sourceLine" id="cb33-55" data-line-number="55"><span class="co">#  </span></a></code></pre></div>
<p>See here we started with a single MULTIPOINT (containing three coordinates), and we are returned three POINTs. Also notice the <code>id</code> and <code>val</code> fields are repeated across the new POINTs.</p>
</div>
</div>
<div id="geojson-c-api" class="section level1">
<h1 class="hasAnchor">
<a href="#geojson-c-api" class="anchor"></a>GeoJSON C++ API</h1>
<p>You can by-pass the <code>spatialwidget::api::</code> namepsace and call the <code>spatialwidget::geojson::</code> api directly. However, doing so will only convert your data to pseudo-geojson, it won’t create colours or legends.</p>
<p>Here are the function definitions, the input data they expect and the type of output they produce.</p>
<hr>
<div id="multi-sfc-column-sf-to-atomised-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#multi-sfc-column-sf-to-atomised-pseudo-geojson" class="anchor"></a>multi-<code>sfc</code>-column <code>sf</code> to atomised pseudo-geojson</h3>
<pre><code>  /*
  * a variation on the atomise function to return an array of atomised features
  */
  inline Rcpp::StringVector to_geojson_atomise(
      Rcpp::DataFrame&amp; sf,
      Rcpp::StringVector&amp; geometries ) {</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_geojson_sf</span>(<span class="dt">sf =</span> widget_arcs, <span class="dt">geometries =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"origin"</span>,<span class="st">"destination"</span>))</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( geojson, <span class="dv">1</span>, <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co">#  [{"type":"Feature","properties":{"country_from":"Australia","capital_from":"Canberra","country_to":"Afghanistan","capital_to":"Kabul"},"geometry":{"origin":{"type":"Point","coordinates":[149.08,-35.15]},"destination":{"type":"Point","coordinates":[69.11,34.28]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country_from":"Australia","capital_from":"Canberra","country_to":"Albania","capital_to":"Tirane"},"geometry":{"origin":{"type":"Point","coordinates":[149.08,-35.15]},"destination":{"type":"Point","coordi</span></a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one or more <code>sfc</code> columns</p>
<p><strong>out</strong> - atomised pseudo-geojson</p>
<hr>
</div>
<div id="single-sfc-column-sf-to-downcasted-atomised-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#single-sfc-column-sf-to-downcasted-atomised-pseudo-geojson" class="anchor"></a>single-<code>sfc</code>-column <code>sf</code> to downcasted, atomised pseudo-geojson</h3>
<pre><code>  // down-casts MULTIGEOMETRIES to their simpler geometry
  // only for one-column sfc objects
  inline Rcpp::StringVector to_geojson_downcast_atomise(
      Rcpp::DataFrame&amp; sf,
      std::string geometry ) {</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_sf_to_geojson_downcast</span>( <span class="dt">sf =</span> widget_capitals, <span class="dt">geometry_column =</span> <span class="st">"geometry"</span> )</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( geojson, <span class="dv">1</span>, <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="co">#  [{"type":"Feature","properties":{"country":"Afghanistan","capital":"Kabul"},"geometry":{"geometry":{"type":"Point","coordinates":[69.11,34.28]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Albania","capital":"Tirane"},"geometry":{"geometry":{"type":"Point","coordinates":[19.49,41.18]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Algeria","capital":"Algiers"},"geometry":{"geometry":{"type":"Point","coordinates":[3.08,36.42]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"American Samoa","capital":"</span></a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one <code>sfc</code> column</p>
<p><strong>out</strong> - pseudo-geojson downcast to simpler form</p>
<hr>
</div>
<div id="two-sfc-column-sf-to-downcasted-atomised-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#two-sfc-column-sf-to-downcasted-atomised-pseudo-geojson" class="anchor"></a>two-<code>sfc</code>-column <code>sf</code> to downcasted, atomised pseudo-geojson</h3>
<pre><code>  inline Rcpp::StringVector to_geojson_downcast_atomise(
      Rcpp::DataFrame&amp; sf,
      Rcpp::StringVector geometries )
    {</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">feat1 &lt;-<span class="st"> '{"type":"Feature","properties":{"id":1},"geometry":{"type":"MultiPoint","coordinates":[[0,0],[2,2],[4,4]]}}'</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">feat2 &lt;-<span class="st"> '{"type":"Feature","properties":{"id":2},"geometry":{"type":"MultiPoint","coordinates":[[1,1],[3,3],[5,5]]}}'</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3">sf1 &lt;-<span class="st"> </span>geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/geojson_sf">geojson_sf</a></span>( feat1 )</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">sf2 &lt;-<span class="st"> </span>geojsonsf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geojsonsf/topics/geojson_sf">geojson_sf</a></span>( feat2 )</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"></a>
<a class="sourceLine" id="cb39-6" data-line-number="6">sf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>( sf1, sf2)</a>
<a class="sourceLine" id="cb39-7" data-line-number="7"></a>
<a class="sourceLine" id="cb39-8" data-line-number="8">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_sf_to_geojson_multi_column_downcast</span>( <span class="dt">sf =</span> sf, <span class="dt">geometries =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"geometry"</span>,<span class="st">"geometry.1"</span>))</a>
<a class="sourceLine" id="cb39-9" data-line-number="9">geojson</a>
<a class="sourceLine" id="cb39-10" data-line-number="10"><span class="co">#  [{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[0.0,0.0]},"geometry.1":{"type":"Point","coordinates":[1.0,1.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[2.0,2.0]},"geometry.1":{"type":"Point","coordinates":[1.0,1.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[4.0,4.0]},"geometry.1":{"type":"Point","coordinates":[1.0,1.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[0.0,0.0]},"geometry.1":{"type":"Point","coordinates":[3.0,3.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[2.0,2.0]},"geometry.1":{"type":"Point","coordinates":[3.0,3.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[4.0,4.0]},"geometry.1":{"type":"Point","coordinates":[3.0,3.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[0.0,0.0]},"geometry.1":{"type":"Point","coordinates":[5.0,5.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[2.0,2.0]},"geometry.1":{"type":"Point","coordinates":[5.0,5.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"id":1.0,"id.1":2.0},"geometry":{"geometry":{"type":"Point","coordinates":[4.0,4.0]},"geometry.1":{"type":"Point","coordinates":[5.0,5.0]</span><span class="re">}}}</span><span class="co">]</span></a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with two <code>sfc</code> columns</p>
<p><strong>out</strong> - pseudo-geojson down-cast to simpler form. It will repeat the other columns to the correct length.</p>
<hr>
</div>
<div id="single-sfc-column-sf-to-standard-geojson-1" class="section level3">
<h3 class="hasAnchor">
<a href="#single-sfc-column-sf-to-standard-geojson-1" class="anchor"></a>single-<code>sfc</code>-column <code>sf</code> to standard geojson</h3>
<pre><code>inline Rcpp::StringVector to_geojson( Rcpp::DataFrame&amp; sf, std::string geom_column )</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_geojson</span>( <span class="dt">sf =</span> widget_capitals, <span class="dt">geometry =</span> <span class="st">"geometry"</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( geojson, <span class="dv">1</span>, <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="co">#  {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"country":"Afghanistan","capital":"Kabul"},"geometry":{"type":"Point","coordinates":[69.11,34.28]}},{"type":"Feature","properties":{"country":"Albania","capital":"Tirane"},"geometry":{"type":"Point","coordinates":[19.49,41.18]}}</span></a></code></pre></div>
<p><strong>in</strong> - <code>sf</code> object with one <code>sfc</code> column</p>
<p><strong>out</strong> - standard GeoJSON</p>
<hr>
</div>
<div id="data-frame-with-lon-lat-columsn-to-atomised-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frame-with-lon-lat-columsn-to-atomised-pseudo-geojson" class="anchor"></a><code>data.frame</code> with lon &amp; lat columsn to atomised pseudo-geojson</h3>
<pre><code>  inline Rcpp::StringVector to_geojson_atomise(
      Rcpp::DataFrame&amp; df,
      Rcpp::List&amp; geometries ) // i.e., list(origin = c("start_lon", "start_lat", destination = c("end_lon", "end_lat")))
  {</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>( widget_capitals )</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">coords &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>( widget_capitals )</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">df[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)] &lt;-<span class="st"> </span>coords</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">df<span class="op">$</span>geometry &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"></a>
<a class="sourceLine" id="cb43-6" data-line-number="6">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_geojson_df</span>(<span class="dt">df =</span> df, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">geometry =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)) )</a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( geojson, <span class="dv">1</span>, <span class="dv">500</span> )</a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="co">#  [{"type":"Feature","properties":{"country":"Afghanistan","capital":"Kabul"},"geometry":{"geometry":{"type":"Point","coordinates":[69.11,34.28]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Albania","capital":"Tirane"},"geometry":{"geometry":{"type":"Point","coordinates":[19.49,41.18]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Algeria","capital":"Algiers"},"geometry":{"geometry":{"type":"Point","coordinates":[3.08,36.42]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"American Samoa","capital":"</span></a></code></pre></div>
<p><strong>in</strong> - <code>data.frame</code> with lon &amp; lat columns</p>
<p><strong>out</strong> - pseudo-GeoJSON atomised</p>
<hr>
</div>
<div id="data-frame-with-lon-lat-and-elevation-columns-to-atomised-pseudo-geojson" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frame-with-lon-lat-and-elevation-columns-to-atomised-pseudo-geojson" class="anchor"></a><code>data.frame</code> with lon, lat and elevation columns to atomised pseudo-geojson</h3>
<pre><code>  // list of geometries is designed for lon &amp; lat columns of data
  inline Rcpp::StringVector to_geojson_z_atomise(
      Rcpp::DataFrame&amp; df,
      Rcpp::List&amp; geometries ) // i.e., list(origin = c("start_lon", "start_lat", destination = c("end_lon", "end_lat")))
  {</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">df<span class="op">$</span>z &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>, <span class="dt">size =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df), <span class="dt">replace =</span> <span class="ot">TRUE</span> )</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">geojson &lt;-<span class="st"> </span>spatialwidget<span class="op">:::</span><span class="kw">rcpp_geojson_dfz</span>( df, <span class="dt">geometries =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">geometry =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>,<span class="st">"z"</span>) ) )</a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>( geojson, <span class="dv">1</span>, <span class="dv">500</span> )</a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="co">#  [{"type":"Feature","properties":{"country":"Afghanistan","capital":"Kabul"},"geometry":{"geometry":{"type":"Point","coordinates":[69.11,34.28,10.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Albania","capital":"Tirane"},"geometry":{"geometry":{"type":"Point","coordinates":[19.49,41.18,454.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"Algeria","capital":"Algiers"},"geometry":{"geometry":{"type":"Point","coordinates":[3.08,36.42,190.0]</span><span class="re">}}}</span><span class="co">,{"type":"Feature","properties":{"country":"American S</span></a></code></pre></div>
<p><strong>in</strong> - <code>data.frame</code> with lon, lat and elevation columns</p>
<p><strong>out</strong> - pseudo-GeoJSON atomised</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#spatialwidget">Spatialwidget</a></li>
      <li><a href="#design">Design</a></li>
      <li>
<a href="#r-interface">R Interface</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pseudo-geojson">Pseudo-GeoJSON</a></li>
      <li><a href="#examples">Examples</a></li>
      </ul>
</li>
      <li>
<a href="#c-api">C++ API</a><ul class="nav nav-pills nav-stacked">
<li><a href="#c-arguments">C++ arguments</a></li>
      <li><a href="#function-dependent-arguments">Function-dependent arguments</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#atomising-geojson">Atomising geojson</a></li>
      <li><a href="#downcasting-geojson">Downcasting geojson</a></li>
      </ul>
</li>
      <li><a href="#geojson-c-api">GeoJSON C++ API</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by David Cooley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
